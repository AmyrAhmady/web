"use strict";(self.webpackChunkomp_web=self.webpackChunkomp_web||[]).push([[36214],{28453:(e,n,a)=>{a.d(n,{R:()=>i,x:()=>s});var t=a(96540);const r={},l=t.createContext(r);function i(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(l.Provider,{value:n},e.children)}},56520:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>d,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"scripting/callbacks/OnPlayerUpdate","title":"OnPlayerUpdate","description":"This callback is called every time a client/player updates the server with their status.","source":"@site/i18n/zh-cn/docusaurus-plugin-content-docs/current/scripting/callbacks/OnPlayerUpdate.md","sourceDirName":"scripting/callbacks","slug":"/scripting/callbacks/OnPlayerUpdate","permalink":"/zh-cn/docs/scripting/callbacks/OnPlayerUpdate","draft":false,"unlisted":false,"editUrl":"https://github.com/openmultiplayer/web/tree/master/frontend/docs/scripting/callbacks/OnPlayerUpdate.md","tags":[{"inline":true,"label":"player","permalink":"/zh-cn/docs/tags/player"}],"version":"current","frontMatter":{"title":"OnPlayerUpdate","sidebar_label":"OnPlayerUpdate","description":"This callback is called every time a client/player updates the server with their status.","tags":["player"]},"sidebar":"docsSidebar","previous":{"title":"OnPlayerText","permalink":"/zh-cn/docs/scripting/callbacks/OnPlayerText"},"next":{"title":"OnPlayerWeaponShot","permalink":"/zh-cn/docs/scripting/callbacks/OnPlayerWeaponShot"}}');var r=a(74848),l=a(28453);const i={title:"OnPlayerUpdate",sidebar_label:"OnPlayerUpdate",description:"This callback is called every time a client/player updates the server with their status.",tags:["player"]},s=void 0,o={},c=[{value:"Description",id:"description",level:2},{value:"Returns",id:"returns",level:2},{value:"Examples",id:"examples",level:2},{value:"Notes",id:"notes",level:2}];function p(e){const n={admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,l.R)(),...e.components},{TipNPCCallbacks:a}=n;return a||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("TipNPCCallbacks",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,r.jsx)(n.p,{children:"This callback is called every time a client/player updates the server with their status. It is often used to create custom callbacks for client updates that aren't actively tracked by the server, such as health or armor updates or players switching weapons."}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Name"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"playerid"}),(0,r.jsx)(n.td,{children:"ID of the player sending an update packet."})]})})]}),"\n",(0,r.jsx)(n.h2,{id:"returns",children:"Returns"}),"\n",(0,r.jsx)(n.p,{children:"0 - Update from this player will not be replicated to other clients."}),"\n",(0,r.jsx)(n.p,{children:"1 - Indicates that this update can be processed normally and sent to other players."}),"\n",(0,r.jsx)(n.p,{children:"It is always called first in filterscripts."}),"\n",(0,r.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example 1"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'new WEAPON:gPlayerCurrentWeapon[MAX_PLAYERS];\n\npublic OnPlayerUpdate(playerid)\n{\n    new WEAPON:weapon = GetPlayerWeapon(playerid); // Return the player\'s current weapon\n    if (weapon != gPlayerCurrentWeapon[playerid]) // If he changed weapons since the last update\n    {\n        // Lets call a callback named OnPlayerWeaponChange\n        CallLocalFunction("OnPlayerWeaponChange", "iii", playerid, gPlayerCurrentWeapon[playerid], weapon);\n        gPlayerCurrentWeapon[playerid] = weapon; // Update the weapon variable\n    }\n    return 1; // Send this update to other players.\n}\n\nforward OnPlayerWeaponChange(playerid, WEAPON:oldWeapon, WEAPON:newWeapon);\npublic OnPlayerWeaponChange(playerid, WEAPON:oldWeapon, WEAPON:newWeapon)\n{\n    new \n        string[128],\n        oldWeaponName[24],\n        newWeaponName[24];\n\n    GetWeaponName(oldWeapon, oldWeaponName, sizeof(oldWeaponName));\n    GetWeaponName(newWeapon, newWeaponName, sizeof(newWeaponName));\n\n    format(string, sizeof(string), "You changed weapon from %s to %s!", oldWeaponName, newWeaponName);\n    SendClientMessage(playerid, 0xFFFFFFFF, string);\n    return 1;\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example 2"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'public OnPlayerUpdate(playerid)\n{\n    new Float:fHealth;\n    GetPlayerHealth(playerid, fHealth);\n\n    if (fHealth\xa0!= GetPVarFloat(playerid, "faPlayerHealth"))\n    {\n        // Player health has changed since the last update -> server, so obviously thats the thing updated.\n        // Lets do further checks see if he\'s lost or gained health, anti-health cheat?\xa0;)\n\n        if (fHealth > GetPVarFloat(playerid, "faPlayerHealth"))\n        {\n            /* He has gained health! Cheating? Write your own scripts here to figure how a player\n            gained health! */\n        }\n        else\n        {\n            /* He has lost health! */\n        }\n\n        SetPVarFloat(playerid, "faPlayerHealth", fHealth);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,r.jsx)(a,{}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"This callback is called, on average, 30 times per second, per player; only use it when you know what it's meant for (or more importantly what it's NOT meant for). The frequency with which this callback is called for each player varies, depending on what the player is doing. Driving or shooting will trigger a lot more updates than idling."})})]})}function d(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}}}]);